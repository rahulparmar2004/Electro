<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Ecomall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body class="bg-gray-100">

    <!-- HEADER -->
    <header class="sticky top-0 z-50 shadow-xl bg-white text-gray-900">
        <div class="flex items-center justify-between px-6 py-4 max-w-7xl mx-auto">
            <h1 class="text-2xl font-bold text-blue-600">Admin Dashboard</h1>
            <button class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg logout">Logout</button>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <div class="max-w-7xl mx-auto p-10">

        <!-- ADD PRODUCT BUTTON -->
        <div class="flex justify-end mb-6">
            <button id="addProductBtn"
                class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">+ Add
                Product</button>
        </div>

        <!-- PRODUCT TABLE -->
        <div class="bg-white shadow rounded-lg overflow-x-auto">
            <table class="min-w-full">
                <thead class="bg-gray-200">
                    <tr>
                        <th class="py-3 px-4 text-left">ID</th>
                        <th class="py-3 px-4 text-left">Image</th>
                        <th class="py-3 px-4 text-left">Title</th>
                        <th class="py-3 px-4 text-left">Category</th>
                        <th class="py-3 px-4 text-left">Price</th>
                        <th class="py-3 px-4 text-left">Actions</th>
                    </tr>
                </thead>
                <tbody id="adminProductsTable">
                    <!-- JS populates products here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ADD/EDIT PRODUCT MODAL -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg w-full max-w-lg p-8 relative">
            <h2 id="modalTitle" class="text-xl font-bold mb-4">Add Product</h2>
            <form id="productForm" class="flex flex-col gap-4">
                <!-- ID Input Visible -->
                <input type="text" id="productId" placeholder="Product ID" class="border rounded px-4 py-2 w-full">
                <input type="text" id="title" placeholder="Title" class="border rounded px-4 py-2 w-full">
                <input type="text" id="brand" placeholder="Brand" class="border rounded px-4 py-2 w-full">
                <input type="text" id="category" placeholder="Category" class="border rounded px-4 py-2 w-full">
                <input type="number" id="price" placeholder="Price" class="border rounded px-4 py-2 w-full">
                <input type="text" id="image" placeholder="Image URL" class="border rounded px-4 py-2 w-full">
                <input type="number" step="0.1" id="rating" placeholder="Rating"
                    class="border rounded px-4 py-2 w-full">
                <textarea id="description" placeholder="Description" class="border rounded px-4 py-2 w-full"></textarea>
                <div class="flex justify-end gap-2">
                    <button type="button" id="cancelBtn"
                        class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
                    <button type="submit"
                        class="bg-blue-600 px-4 py-2 rounded text-white hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let products = [];

        const adminProductsTable = document.getElementById("adminProductsTable");
        const productModal = document.getElementById("productModal");
        const addProductBtn = document.getElementById("addProductBtn");
        const cancelBtn = document.getElementById("cancelBtn");
        const productForm = document.getElementById("productForm");
        const modalTitle = document.getElementById("modalTitle");

        // Fetch Products
        function fetchProducts() {
            fetch("http://localhost:3000/products")
                .then(res => res.json())
                .then(data => {
                    products = data;
                    renderProducts();
                });
        }

        // Render Table
        function renderProducts() {
            adminProductsTable.innerHTML = "";
            products.forEach(p => {
                const row = document.createElement("tr");
                row.className = "border-b hover:bg-gray-50";
                row.innerHTML = `
            <td class="py-2 px-4">${p.id}</td>
            <td class="py-2 px-4"><img src="${p.image}" class="w-16 h-16 object-cover rounded" alt="${p.title}"></td>
            <td class="py-2 px-4">${p.title}</td>
            <td class="py-2 px-4">${p.category}</td>
            <td class="py-2 px-4">â‚¹${p.price}</td>
            <td class="py-2 px-4 flex gap-2">
                <button class="edit-btn bg-yellow-500 px-3 py-1 rounded text-white" data-id="${p.id}">Edit</button>
                <button class="delete-btn bg-red-500 px-3 py-1 rounded text-white" data-id="${p.id}">Delete</button>
            </td>
        `;
                adminProductsTable.appendChild(row);
            });
        }

        // Open Modal
        addProductBtn.addEventListener("click", () => {
            modalTitle.innerText = "Add Product";
            productForm.reset();
            document.getElementById("productId").value = "";
            productModal.classList.remove("hidden");
        });

        // Cancel Modal
        cancelBtn.addEventListener("click", () => productModal.classList.add("hidden"));

        // Submit Form (Add/Edit)
        productForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const id = document.getElementById("productId").value;
            const newProduct = {
                id: id,
                title: document.getElementById("title").value,
                brand: document.getElementById("brand").value,
                category: document.getElementById("category").value,
                price: Number(document.getElementById("price").value),
                quantity: 1,  // <- always 1, no input needed
                image: document.getElementById("image").value,
                rating: Number(document.getElementById("rating").value),
                description: document.getElementById("description").value
            };

            if (products.some(p => String(p.id) === id)) {
                // Edit Product
                fetch(`http://localhost:3000/products/${id}`, {
                    method: "PATCH",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(newProduct)
                }).then(() => {
                    fetchProducts();
                    productModal.classList.add("hidden");
                });
            } else {
                // Add Product
                fetch("http://localhost:3000/products", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(newProduct)
                }).then(() => {
                    fetchProducts();
                    productModal.classList.add("hidden");
                });
            }
        });

        // Edit/Delete Buttons
        adminProductsTable.addEventListener("click", e => {
            const id = e.target.dataset.id;
            if (e.target.classList.contains("edit-btn")) {
                const product = products.find(p => String(p.id) === id);
                modalTitle.innerText = "Edit Product";
                document.getElementById("productId").value = product.id;
                document.getElementById("title").value = product.title;
                document.getElementById("brand").value = product.brand;
                document.getElementById("category").value = product.category;
                document.getElementById("price").value = product.price;
                document.getElementById("image").value = product.image;
                document.getElementById("rating").value = product.rating;
                document.getElementById("description").value = product.description;
                productModal.classList.remove("hidden");
            } else if (e.target.classList.contains("delete-btn")) {
                if (confirm("Are you sure you want to delete this product?")) {
                    fetch(`http://localhost:3000/products/${id}`, { method: "DELETE" })
                        .then(() => fetchProducts());
                }
            }
        });

        // Initial Load
        fetchProducts();

        // logout
        document.querySelector(".logout").addEventListener("click",()=>{
            window.location.href = "home.html"
        });
    </script>

</body>

</html>